Blog={Settings:{}};Blog.Settings.ImageSrcPrefix="images/posts/";Blog.Settings.MaxPostsPerPage=5;Blog.Navigation={};Blog.Navigation.PostsSection="Posts";Blog.Navigation.SinglePostSection="SinglePost";Blog.Navigation.ArchiveSection="Archive";Blog.Navigation.RandomSection="Random";Blog.Navigation.TagsSection="Tags";Blog.Navigation.SingleTagSection="SingleTag";Blog.Navigation.refreshCurrentPage=function(){Blog.Navigation.Section=Blog.Navigation.getCurrentSection();Blog.Navigation.CurrentPage=Blog.Navigation.getCurrentPage()};
Blog.Navigation.wireUpHashChangeListener=function(){$(window).on("hashchange",Blog.Navigation.onHashChange)};Blog.Navigation.onHashChange=function(){if(Blog.PostData.Index)Blog.Navigation.naviagteToPage();else{var a=Blog.Data.getIndexDataUrl();$.get(a).done(function(a){Blog.Data.load(a);Blog.Navigation.naviagteToPage()}).fail(Blog.Content.reportLoadFailure)}};
Blog.Navigation.getCurrentSection=function(){var a=Blog.Navigation.PostsSection,b=location.hash.substring(2);b&&0==b.indexOf("archive")?a=Blog.Navigation.ArchiveSection:b&&0==b.indexOf("tags")?a=Blog.Navigation.TagsSection:b&&0==b.indexOf("random")?a=Blog.Navigation.RandomSection:b&&0==b.indexOf("post-")?a=Blog.Navigation.SinglePostSection:b&&0==b.indexOf("tag-")&&(a=Blog.Navigation.SingleTagSection);return a};Blog.Navigation.buildPageLink=function(a){return"#!page"+a};
Blog.Navigation.buildSinglePostLink=function(a){return"#!post-"+a};Blog.Navigation.buildTagLink=function(a){return"#!tag-"+a};Blog.Navigation.buildImageSrc=function(a,b){return Blog.Settings.ImageSrcPrefix+Blog.Data.formatDateYearSlashMonth(a)+"/"+b};Blog.Navigation.getSelectedSinglePostId=function(){var a=location.hash.indexOf("post-")+5;return location.hash.substring(a)};Blog.Navigation.getSelectedSingleTag=function(){var a=location.hash.indexOf("tag-")+4;return unescape(location.hash.substring(a))};
Blog.Navigation.getCurrentPage=function(){var a=1,b=location.hash.substring(2);b&&0==b.indexOf("page")&&(a=parseInt(b.substring(4))||1);return a};Blog.Navigation.getMinPage=function(){if(3>=Blog.Navigation.CurrentPage)return 1;var a=Blog.Navigation.CurrentPage-2,b=Blog.Navigation.getTotalPages();Blog.Navigation.CurrentPage+2>b&&(a=b-4);return a};
Blog.Navigation.getMaxPage=function(){var a=3>=Blog.Navigation.CurrentPage?5:Blog.Navigation.CurrentPage+2,b=Blog.Navigation.getTotalPages();return a>b?b:a};Blog.Navigation.getTotalPages=function(){return Math.ceil(Blog.PostData.Index.length/Blog.Settings.MaxPostsPerPage)};Blog.Navigation.getPostIndex=function(a){for(var b=0;b<Blog.PostData.Index.length&&Blog.PostData.Index[b].id!=a;)b++;return b};
Blog.Navigation.naviagteToPage=function(){Blog.Navigation.refreshCurrentPage();Blog.Content.reset();Blog.Navigation.Section==Blog.Navigation.ArchiveSection?Blog.Content.renderArchive():Blog.Navigation.Section==Blog.Navigation.TagsSection?Blog.Content.renderTags():Blog.Navigation.Section==Blog.Navigation.RandomSection?Blog.Content.renderRandom():Blog.Navigation.Section==Blog.Navigation.SinglePostSection?Blog.Content.renderSinglePost():Blog.Navigation.Section==Blog.Navigation.SingleTagSection?Blog.Content.renderSingleTag():
Blog.Content.renderRecentPosts()};Blog.Data={};Blog.Data.DataRoot="posts/v1/";Blog.Data.getIndexDataUrl=function(){return Blog.Data.DataRoot+"index.json"};Blog.Data.getPostDataUrl=function(a){var b=Blog.Navigation.getPostIndex(a),c=Blog.Data.parseIsoDate(Blog.PostData.Index[b].date);b=c.getMonth()+1;c=c.getFullYear();return Blog.Data.DataRoot+c+"/"+(10>b?"0"+b:b)+"/"+a+".json"};Blog.Data.load=function(a){Blog.PostData.Index=a.posts;Blog.PostData.TagCloud=a.tags};
Blog.Data.loadPost=function(a){a=Blog.Data.getPostDataUrl(a);$.get(a).done(Blog.Content.renderPost).fail(Blog.Content.reportPostLoadFailure)};Blog.Data.convertImageUrlToThumbUrl=function(a){var b=a.lastIndexOf(".");return a.substring(0,b+1)+"thumb"+a.substring(b,a.length)};Blog.Data.convertImageUrlToSmallUrl=function(a){var b=a.lastIndexOf(".");return a.substring(0,b+1)+"small"+a.substring(b,a.length)};Blog.Data.LongMonthNames="January February March April May June July August September October November December".split(" ");
Blog.Data.parseIsoDate=function(a){return new Date(Date.parse(a))};Blog.Data.formatDateLongMonthYear=function(a){var b=a.getMonth();a=a.getFullYear();return Blog.Data.LongMonthNames[b]+" "+a};Blog.Data.formatDateYearSlashMonth=function(a){var b=a.getFullYear();a=a.getMonth()+1;return b+"/"+(9<a?a:"0"+a)};Blog.Data.formatDateDdMmmYyyy=function(a){var b=a.getDate(),c=a.getMonth();a=a.getFullYear();return Blog.Data.formatOrdinalNumber(b)+" "+Blog.Data.LongMonthNames[c].substring(0,3)+" "+a};
Blog.Data.formatOrdinalNumber=function(a){var b=a%10,c=a%100;return 1==b&&11!=c?a+"st":2==b&&12!=c?a+"nd":3==b&&13!=c?a+"rd":a+"th"};Blog.Css={};Blog.Css.ImageRowLayout=["post-image-100","post-image-50","post-image-33","post-image-25"];Blog.Content={};Blog.Content.reset=function(){$("html,body").animate({scrollTop:0});$(".container").empty();$(".container-wide").empty()};
Blog.Content.renderRecentPosts=function(){for(var a=$("<div>").attr("id","posts").appendTo($(".container")),b=(Blog.Navigation.CurrentPage-1)*Blog.Settings.MaxPostsPerPage,c=b+Blog.Settings.MaxPostsPerPage;b<c&&b<Blog.PostData.Index.length;b++){var d=Blog.PostData.Index[b].id;a.append($("<div>").addClass("post").attr("id",d));Blog.Data.loadPost(d)}Blog.Content.createPagingControls()};
Blog.Content.renderSinglePost=function(){var a=$("<div>").attr("id","posts").appendTo($(".container")),b=Blog.Navigation.getSelectedSinglePostId();a.append($("<div>").addClass("post").attr("id",b));Blog.Data.loadPost(b);Blog.Content.createNextAndPreviousPagingControls(b)};Blog.Content.renderPost=function(a){var b=Blog.Content.createPost(a);$("#"+a.id).append(b)};
Blog.Content.reportLoadFailure=function(){Blog.Content.reset();var a=$("<p>").text("Error loading posts - please try again later.").addClass("error");$(".container").html(a)};Blog.Content.reportPostLoadFailure=function(){console.log("Unable to load post")};
Blog.Content.createPost=function(a){var b=$("<div>").addClass("post-date"),c=Blog.Data.parseIsoDate(a.date),d=Blog.Data.formatDateDdMmmYyyy(c);Blog.Navigation.Section!=Blog.Navigation.SinglePostSection?(d=$("<a></a>").addClass("single-post").attr("href",Blog.Navigation.buildSinglePostLink(a.id)).text(d),$("<p>").append(d).appendTo(b)):$("<p>").text(d).appendTo(b);d=$("<div>").addClass("post-title");a.title&&$("<h2>").text(a.title).appendTo(d);var e=$("<div>").addClass("post-intro");a.intro&&$("<p>").text(a.intro).appendTo(e);
var f=$("<div>").addClass("post-images");if(a.images)for(var g="photo-set-"+a.id,h=a.images.fileNames.length,l=a.images.rowSizes.length,k=0,m=0;m<l;m++)for(var p=a.images.rowSizes[m],r=Blog.Css.ImageRowLayout[p-1],t=$("<div>").addClass("post-images-row").appendTo(f),q=0;q<p&&k<h;q++){var n=Blog.Navigation.buildImageSrc(c,a.images.fileNames[k]),u=Blog.Data.convertImageUrlToSmallUrl(n);n=$("<a>").attr("href",n).attr("data-lightbox",g).appendTo(t);$("<img>").attr("src",u).addClass(r).appendTo(n);k++}c=
$("<div>").addClass("post-video");a.video&&$("<iframe>").attr("width",490).attr("height",350).attr("frameborder",0).attr("allow","autoplay; encrypted-media").attr("allowfullscreen","").attr("src","https://www.youtube-nocookie.com/embed/"+a.video).appendTo(c);g=$("<div>").addClass("post-body");if(a.content)for(h=0;h<a.content.length;h++)l=Blog.Content.createContentParagraph(a.content[h],a.contentLinks),g.append(l);h=$("<div>").addClass("tags");if(a.tags&&0<a.tags.length)for(l=$("<ul>").appendTo(h),
k=0;k<a.tags.length;k++)m=$("<li>").addClass("tag").appendTo(l),$("<a>").attr("href",Blog.Navigation.buildTagLink(a.tags[k])).text(a.tags[k]).appendTo(m);a=$("<div>").addClass("post");a.append(b);a.append(d);a.append(e);a.append(f);a.append(c);a.append(g);a.append(h);return a};
Blog.Content.createContentParagraph=function(a,b){var c=$("<p>");if(!b)return $("<span>").text(a).appendTo(c),c;for(var d=Blog.Content.findNextLink(a,b);null!=d;){if(0<d.index){var e=a.substring(0,d.index);$("<span>").text(e).appendTo(c)}e=d.placeholder.substring(1,d.placeholder.length-1);var f=d.url;$("<a></a>").attr("href",f).attr("target","_blank").text(e).appendTo(c);a=a.substring(d.index+d.placeholder.length);d=Blog.Content.findNextLink(a,b)}0<a.length&&$("<span>").text(a).appendTo(c);return c};
Blog.Content.findNextLink=function(a,b){for(var c={index:-1},d=0;d<b.length;d++){var e=b[d][0],f=a.indexOf(e);0<=f&&(-1==c.index||f<c.index)&&(c.index=f,c.placeholder=e,c.url=b[d][1])}return-1==c.index?null:c};
Blog.Content.createPagingControls=function(){var a=Blog.Navigation.getMinPage(),b=Blog.Navigation.getMaxPage(),c=Blog.Navigation.getTotalPages(),d=$("<ul>");if(1<a){var e=$("<li>").addClass("paging").addClass("paging-newer").appendTo(d),f=Blog.Navigation.buildPageLink(a-1);$("<a></a>").attr("href",f).text("Newer").appendTo(e)}for(;a<=b;a++)e=$("<li>").addClass("paging").appendTo(d),a!=Blog.Navigation.CurrentPage?(f=Blog.Navigation.buildPageLink(a),$("<a></a>").attr("href",f).text(a).appendTo(e)):
e.text(a);b<c&&(c=$("<li>").addClass("paging").addClass("paging-older").appendTo(d),f=Blog.Navigation.buildPageLink(b+1),$("<a></a>").attr("href",f).text("Older").appendTo(c));b=$("<div>").addClass("navigation");b.append(d);$(".container").append(b)};
Blog.Content.createNextAndPreviousPagingControls=function(a){var b=Blog.Navigation.getPostIndex(a);a=$("<ul>");if(0<=b-1){var c=$("<li>").addClass("paging").appendTo(a),d=Blog.Navigation.buildSinglePostLink(Blog.PostData.Index[b-1].id);$("<a></a>").attr("href",d).text("Newer").appendTo(c)}b+1<Blog.PostData.Index.length&&(c=$("<li>").addClass("paging").appendTo(a),d=Blog.Navigation.buildSinglePostLink(Blog.PostData.Index[b+1].id),$("<a></a>").attr("href",d).text("Older").appendTo(c));b=$("<div>").addClass("navigation");
b.append(a);$(".container").append(b)};
Blog.Content.renderArchive=function(){for(var a=$("<div>").addClass("archive"),b={},c={},d=0;d<Blog.PostData.Index.length;d++){var e=Blog.PostData.Index[d],f=Blog.Data.parseIsoDate(e.date),g=Blog.Data.formatDateLongMonthYear(f);b!=g&&(b=g,$("<p>").addClass("archive-posts-date").text(b).appendTo(a),c=$("<div>").addClass("archive-posts").appendTo(a));g=$("<div>").addClass("archive-post").appendTo(c);g=$("<a>").attr("href",Blog.Navigation.buildSinglePostLink(e.id)).attr("alt",e.id.replace("-"," ")).appendTo(g);
$("<div>").addClass("archive-post-image-overlay").appendTo(g);$("<span>").text(Blog.Data.formatDateDdMmmYyyy(f)).addClass("archive-post-date").appendTo(g);if(e.coverImage){var h=Blog.Data.convertImageUrlToThumbUrl(e.coverImage);f=Blog.Navigation.buildImageSrc(f,h)}else f="images/archive-placeholder.thumb.jpg";$("<img>").attr("src",f).addClass("archive-post-image").appendTo(g);e.coverImageAlt&&$("<span>").text(e.coverImageAlt).addClass("archive-post-image-alt").appendTo(g);$("<span>").text(Blog.Content.formatArchiveTags(e.tags)).addClass("archive-post-tags").appendTo(g)}$(".container-wide").append(a)};
Blog.Content.formatArchiveTags=function(a){var b="";if(a&&0<a.length)for(var c=0;c<a.length;c++)0<c&&(b+=" "),b+="#",b+=a[c];return b};Blog.Content.renderTags=function(){for(var a=$("<div>").addClass("tag-cloud"),b=0;b<Blog.PostData.TagCloud.length;b++)$("<a>").attr("href",Blog.Navigation.buildTagLink(Blog.PostData.TagCloud[b].name)).text(Blog.PostData.TagCloud[b].name).addClass("tag-group-"+Blog.PostData.TagCloud[b].bucket).appendTo(a);$(".container").append(a)};
Blog.Content.renderSingleTag=function(){var a=Blog.Navigation.getSelectedSingleTag(),b=$("<div>").attr("id","posts");$(".container").append(b);for(var c=0;c<Blog.PostData.Index.length;c++){var d=Blog.PostData.Index[c].tags;if(d)for(var e=0;e<d.length;e++)if(d[e]==a){d=Blog.PostData.Index[c].id;$("<div>").addClass("post").attr("id",d).appendTo(b);Blog.Data.loadPost(d);break}}};
Blog.Content.renderRandom=function(){var a=Blog.Navigation.buildSinglePostLink(Blog.PostData.Index[Math.floor(Math.random()*Blog.PostData.Index.length)].id);location.hash=a};Blog.PostData={};$(function(){Blog.Navigation.wireUpHashChangeListener();Blog.Navigation.onHashChange()});