Blog={},Blog.Settings={},Blog.Settings.ImageSrcPrefix="images/posts/",Blog.Settings.MaxPostsPerPage=5,Blog.Navigation={},Blog.Navigation.PostsSection="Posts",Blog.Navigation.SinglePostSection="SinglePost",Blog.Navigation.ArchiveSection="Archive",Blog.Navigation.RandomSection="Random",Blog.Navigation.TagsSection="Tags",Blog.Navigation.SingleTagSection="SingleTag",Blog.Navigation.refreshCurrentPage=function(){Blog.Navigation.Section=Blog.Navigation.getCurrentSection(),Blog.Navigation.CurrentPage=Blog.Navigation.getCurrentPage()},Blog.Navigation.wireUpHashChangeListener=function(){$(window).on("hashchange",Blog.Navigation.onHashChange)},Blog.Navigation.onHashChange=function(){if(Blog.PostData.Index)Blog.Navigation.naviagteToPage();else{var a=Blog.Data.getIndexDataUrl();$.get(a).done(function(a){Blog.Data.load(a),Blog.Navigation.naviagteToPage()}).fail(Blog.Content.reportLoadFailure)}},Blog.Navigation.getCurrentSection=function(){var a=Blog.Navigation.PostsSection,t=location.hash.substring(2);return t&&0==t.indexOf("archive")?a=Blog.Navigation.ArchiveSection:t&&0==t.indexOf("tags")?a=Blog.Navigation.TagsSection:t&&0==t.indexOf("random")?a=Blog.Navigation.RandomSection:t&&0==t.indexOf("post-")?a=Blog.Navigation.SinglePostSection:t&&0==t.indexOf("tag-")&&(a=Blog.Navigation.SingleTagSection),a},Blog.Navigation.buildPageLink=function(a){return"#!page"+a},Blog.Navigation.buildSinglePostLink=function(a){return"#!post-"+a},Blog.Navigation.buildTagLink=function(a){return"#!tag-"+a},Blog.Navigation.buildImageSrc=function(a,t){return Blog.Settings.ImageSrcPrefix+Blog.Data.formatDateYearSlashMonth(a)+"/"+t},Blog.Navigation.getSelectedSinglePostId=function(){var a=location.hash.indexOf("post-")+5,t=location.hash.substring(a);return t},Blog.Navigation.getSelectedSingleTag=function(){var a=location.hash.indexOf("tag-")+4,t=unescape(location.hash.substring(a));return t},Blog.Navigation.getCurrentPage=function(){var a=1,t=location.hash.substring(2);return t&&0==t.indexOf("page")&&(a=parseInt(t.substring(4))||1),a},Blog.Navigation.getMinPage=function(){if(Blog.Navigation.CurrentPage<=3)return 1;var a=Blog.Navigation.CurrentPage-2,t=Blog.Navigation.getTotalPages();return Blog.Navigation.CurrentPage+2>t&&(a=t-4),a},Blog.Navigation.getMaxPage=function(){var a=Blog.Navigation.CurrentPage<=3?5:Blog.Navigation.CurrentPage+2,t=Blog.Navigation.getTotalPages();return a>t?t:a},Blog.Navigation.getTotalPages=function(){return Math.ceil(Blog.PostData.Index.length/Blog.Settings.MaxPostsPerPage)},Blog.Navigation.getPostIndex=function(a){for(var t=0;t<Blog.PostData.Index.length&&Blog.PostData.Index[t].id!=a;)t++;return t},Blog.Navigation.naviagteToPage=function(){Blog.Navigation.refreshCurrentPage(),Blog.Content.reset(),Blog.Navigation.Section==Blog.Navigation.ArchiveSection?Blog.Content.renderArchive():Blog.Navigation.Section==Blog.Navigation.TagsSection?Blog.Content.renderTags():Blog.Navigation.Section==Blog.Navigation.RandomSection?Blog.Content.renderRandom():Blog.Navigation.Section==Blog.Navigation.SinglePostSection?Blog.Content.renderSinglePost():Blog.Navigation.Section==Blog.Navigation.SingleTagSection?Blog.Content.renderSingleTag():Blog.Content.renderRecentPosts()},Blog.Data={},Blog.Data.DataRoot="posts/v1/",Blog.Data.getIndexDataUrl=function(){return Blog.Data.DataRoot+"index.json"},Blog.Data.getPostDataUrl=function(a){var t=Blog.Navigation.getPostIndex(a),o=Blog.Data.parseIsoDate(Blog.PostData.Index[t].date),e=o.getMonth()+1,n=o.getFullYear(),g=10>e?"0"+e:e;return Blog.Data.DataRoot+n+"/"+g+"/"+a+".json"},Blog.Data.load=function(a){Blog.PostData.Index=a.posts,Blog.PostData.TagCloud=a.tags},Blog.Data.loadPost=function(a){var t=Blog.Data.getPostDataUrl(a);$.get(t).done(Blog.Content.renderPost).fail(Blog.Content.reportPostLoadFailure)},Blog.Data.convertImageUrlToThumbUrl=function(a){var t=a.lastIndexOf(".");return a.substring(0,t+1)+"thumb"+a.substring(t,a.length)},Blog.Data.LongMonthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Blog.Data.parseIsoDate=function(a){return new Date(Date.parse(a))},Blog.Data.formatDateLongMonthYear=function(a){var t=a.getMonth(),o=a.getFullYear();return Blog.Data.LongMonthNames[t]+" "+o},Blog.Data.formatDateYearSlashMonth=function(a){var t=a.getFullYear(),o=a.getMonth()+1;return t+"/"+(o>9?o:"0"+o)},Blog.Data.formatDateDdMmmYyyy=function(a){var t=a.getDate(),o=a.getMonth(),e=a.getFullYear();return Blog.Data.formatOrdinalNumber(t)+" "+Blog.Data.LongMonthNames[o].substring(0,3)+" "+e},Blog.Data.formatOrdinalNumber=function(a){var t=a%10,o=a%100;return 1==t&&11!=o?a+"st":2==t&&12!=o?a+"nd":3==t&&13!=o?a+"rd":a+"th"},Blog.Css={},Blog.Css.ImageRowLayout=["post-image-100","post-image-50","post-image-33","post-image-25"],Blog.Content={},Blog.Content.reset=function(){$("html,body").animate({scrollTop:0}),$(".container").empty(),$(".container-wide").empty()},Blog.Content.renderRecentPosts=function(){for(var a=$("<div>").attr("id","posts").appendTo($(".container")),t=(Blog.Navigation.CurrentPage-1)*Blog.Settings.MaxPostsPerPage,o=t+Blog.Settings.MaxPostsPerPage,e=t;o>e&&e<Blog.PostData.Index.length;e++){var n=Blog.PostData.Index[e].id;a.append($("<div>").addClass("post").attr("id",n)),Blog.Data.loadPost(n)}Blog.Content.createPagingControls()},Blog.Content.renderSinglePost=function(){var a=$("<div>").attr("id","posts").appendTo($(".container")),t=Blog.Navigation.getSelectedSinglePostId();a.append($("<div>").addClass("post").attr("id",t)),Blog.Data.loadPost(t),Blog.Content.createNextAndPreviousPagingControls(t)},Blog.Content.renderPost=function(a){var t=Blog.Content.createPost(a),o=$("#"+a.id);o.append(t)},Blog.Content.reportLoadFailure=function(){Blog.Content.reset();var a=$("<p>").text("Error loading posts - please try again later.").addClass("error");$(".container").html(a)},Blog.Content.reportPostLoadFailure=function(){console.log("Unable to load post")},Blog.Content.createPost=function(a){var t=$("<div>").addClass("post-date"),o=Blog.Data.parseIsoDate(a.date),e=Blog.Data.formatDateDdMmmYyyy(o);if(Blog.Navigation.Section!=Blog.Navigation.SinglePostSection){var n=$("<a></a>").addClass("single-post").attr("href",Blog.Navigation.buildSinglePostLink(a.id)).text(e);$("<p>").append(n).appendTo(t)}else $("<p>").text(e).appendTo(t);var g=$("<div>").addClass("post-title");a.title&&$("<h2>").text(a.title).appendTo(g);var i=$("<div>").addClass("post-intro");a.intro&&$("<p>").text(a.intro).appendTo(i);var r=$("<div>").addClass("post-images"),l="photo-set-"+a.id;if(a.images)for(var s=a.images.fileNames.length,d=a.images.rowSizes.length,v=0,p=0;d>p;p++)for(var B=a.images.rowSizes[p],c=Blog.Css.ImageRowLayout[B-1],u=$("<div>").addClass("post-images-row").appendTo(r),f=0;B>f&&s>v;f++){var h=Blog.Navigation.buildImageSrc(o,a.images.fileNames[v]),P=Blog.Data.convertImageUrlToThumbUrl(h),C=$("<a>").attr("href",h).attr("data-lightbox",l).appendTo(u);$("<img>").attr("src",P).addClass(c).appendTo(C),v++}var N=$("<div>").addClass("post-body");if(a.content)for(var D=0;D<a.content.length;D++){var m=Blog.Content.createContentParagraph(a.content[D],a.contentLinks);N.append(m)}var x=$("<div>").addClass("tags");if(a.tags&&a.tags.length>0)for(var T=$("<ul>").appendTo(x),S=0;S<a.tags.length;S++){var b=$("<li>").addClass("tag").appendTo(T);$("<a>").attr("href",Blog.Navigation.buildTagLink(a.tags[S])).text(a.tags[S]).appendTo(b)}var I=$("<div>").addClass("post");return I.append(t),I.append(g),I.append(i),I.append(r),I.append(N),I.append(x),I},Blog.Content.createContentParagraph=function(a,t){var o=$("<p>");if(!t)return $("<span>").text(a).appendTo(o),o;for(var e=Blog.Content.findNextLink(a,t);null!=e;){if(e.index>0){var n=a.substring(0,e.index);$("<span>").text(n).appendTo(o)}var g=e.placeholder.substring(1,e.placeholder.length-1),i=e.url,r=($("<a></a>").attr("href",i).attr("target","_blank").text(g).appendTo(o),e.index+e.placeholder.length);a=a.substring(r);var e=Blog.Content.findNextLink(a,t)}return a.length>0&&$("<span>").text(a).appendTo(o),o},Blog.Content.findNextLink=function(a,t){for(var o={index:-1},e=0;e<t.length;e++){var n=t[e][0],g=a.indexOf(n);g>=0&&(-1==o.index||g<o.index)&&(o.index=g,o.placeholder=n,o.url=t[e][1])}return-1==o.index?null:o},Blog.Content.createPagingControls=function(){var a=Blog.Navigation.getMinPage(),t=Blog.Navigation.getMaxPage(),o=Blog.Navigation.getTotalPages(),e=$("<ul>");if(a>1){var n=$("<li>").addClass("paging").addClass("paging-newer").appendTo(e),g=Blog.Navigation.buildPageLink(a-1);$("<a></a>").attr("href",g).text("Newer").appendTo(n)}for(var i=a;t>=i;i++){var r=$("<li>").addClass("paging").appendTo(e);if(i!=Blog.Navigation.CurrentPage){var g=Blog.Navigation.buildPageLink(i);$("<a></a>").attr("href",g).text(i).appendTo(r)}else r.text(i)}if(o>t){var l=$("<li>").addClass("paging").addClass("paging-older").appendTo(e),g=Blog.Navigation.buildPageLink(t+1);$("<a></a>").attr("href",g).text("Older").appendTo(l)}var s=$("<div>").addClass("navigation");s.append(e),$(".container").append(s)},Blog.Content.createNextAndPreviousPagingControls=function(a){var t=Blog.Navigation.getPostIndex(a),o=$("<ul>");if(t-1>=0){var e=$("<li>").addClass("paging").appendTo(o),n=Blog.PostData.Index[t-1].id,g=Blog.Navigation.buildSinglePostLink(n);$("<a></a>").attr("href",g).text("Newer").appendTo(e)}if(t+1<Blog.PostData.Index.length){var i=$("<li>").addClass("paging").appendTo(o),r=Blog.PostData.Index[t+1].id,g=Blog.Navigation.buildSinglePostLink(r);$("<a></a>").attr("href",g).text("Older").appendTo(i)}var l=$("<div>").addClass("navigation");l.append(o),$(".container").append(l)},Blog.Content.renderArchive=function(){for(var a=$("<div>").addClass("archive"),t={},o={},e=0;e<Blog.PostData.Index.length;e++){var n=Blog.PostData.Index[e],g=Blog.Data.parseIsoDate(n.date),i=Blog.Data.formatDateLongMonthYear(g);t!=i&&(t=i,$("<p>").addClass("archive-posts-date").text(t).appendTo(a),o=$("<div>").addClass("archive-posts").appendTo(a));var r=$("<div>").addClass("archive-post").appendTo(o),l=$("<a>").attr("href",Blog.Navigation.buildSinglePostLink(n.id)).attr("alt",n.id.replace("-"," ")).appendTo(r);if($("<div>").addClass("archive-post-image-overlay").appendTo(l),$("<span>").text(Blog.Data.formatDateDdMmmYyyy(g)).addClass("archive-post-date").appendTo(l),n.coverImage)var s=Blog.Data.convertImageUrlToThumbUrl(n.coverImage),d=Blog.Navigation.buildImageSrc(g,s);else var d="images/archive-placeholder.thumb.jpg";$("<img>").attr("src",d).addClass("archive-post-image").appendTo(l),n.coverImageAlt&&$("<span>").text(n.coverImageAlt).addClass("archive-post-image-alt").appendTo(l),$("<span>").text(Blog.Content.formatArchiveTags(n.tags)).addClass("archive-post-tags").appendTo(l)}$(".container-wide").append(a)},Blog.Content.formatArchiveTags=function(a){var t="";if(a&&a.length>0)for(var o=0;o<a.length;o++)o>0&&(t+=" "),t+="#",t+=a[o];return t},Blog.Content.renderTags=function(){for(var a=$("<div>").addClass("tag-cloud"),t=0;t<Blog.PostData.TagCloud.length;t++)$("<a>").attr("href",Blog.Navigation.buildTagLink(Blog.PostData.TagCloud[t].name)).text(Blog.PostData.TagCloud[t].name).addClass("tag-group-"+Blog.PostData.TagCloud[t].bucket).appendTo(a);$(".container").append(a)},Blog.Content.renderSingleTag=function(){var a=Blog.Navigation.getSelectedSingleTag(),t=$("<div>").attr("id","posts");$(".container").append(t);for(var o=0;o<Blog.PostData.Index.length;o++){var e=Blog.PostData.Index[o].tags;if(e)for(var n=0;n<e.length;n++)if(e[n]==a){var g=Blog.PostData.Index[o].id;$("<div>").addClass("post").attr("id",g).appendTo(t),Blog.Data.loadPost(g);break}}},Blog.Content.renderRandom=function(){var a=Math.floor(Math.random()*Blog.PostData.Index.length),t=Blog.PostData.Index[a],o=Blog.Navigation.buildSinglePostLink(t.id);location.hash=o},Blog.PostData={},$(function(){Blog.Navigation.wireUpHashChangeListener(),Blog.Navigation.onHashChange()});